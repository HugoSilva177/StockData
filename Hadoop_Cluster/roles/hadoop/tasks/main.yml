---
- name: 'Instalar pacotes necessários'
  apt:
    name:
      - ssh
      - pdsh
      - openjdk-8-jdk
    state: latest
  become: yes

- name: "Adicionar linha ao arquivo .bashrc"
  ansible.builtin.lineinfile:
    path: /home/vagrant/.bashrc
    line: export PDSH_RCMD_TYPE=ssh

- name: "Verificar se chave pública já existe"
  stat: path=/home/vagrant/.ssh/id_rsa.pub
  register: pub_key_created

- name: "Gerar chave pública com ssh-keygen"
  command: ssh-keygen -t rsa -f /home/vagrant/.ssh/id_rsa -P ""
  when: pub_key_created.stat.exists == False

- name: "Adicionar chave pública ao "
  shell: cat /home/vagrant/.ssh/id_rsa.pub >> /home/vagrant/.ssh/authorized_keys

- name: "Verificar se a pasta hadoop já existe"
  stat: path=/home/vagrant/hadoop
  register: hadoop_created

- name: 'Baixar o arquivo de instalação do Hadoop se ainda não existir'
  get_url:
    url: 'https://mirrors.sonic.net/apache/hadoop/common/hadoop-3.2.1/hadoop-3.2.1.tar.gz'
    dest: '/tmp/hadoop.tar.gz'
  when: hadoop_created.stat.exists == False

- name: 'Descompactar o arquivo hadoop-3.2.1.tar.gz se ainda não existir'
  unarchive:
    src: '/tmp/hadoop.tar.gz'
    dest: '/home/vagrant/'
    remote_src: yes
  become: yes
  when: hadoop_created.stat.exists == False

- name: 'Renomeando pasta para apenas hadoop se ainda não existir'
  command: mv /home/vagrant/hadoop-3.2.1 /home/vagrant/hadoop
  when: hadoop_created.stat.exists == False
